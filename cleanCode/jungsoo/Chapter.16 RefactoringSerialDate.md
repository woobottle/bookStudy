# Chapter.16 RefactoringSerialDate

- JCommon 라이브러리 / [org.jfree.date](http://org.jfree.date) 패키지 / SerialDate 클래스
- SerialDate는 날짜를 표현하는 자바 클래스이다.
    
    ⇒ 기존 Java 클래스에서 자주 느꼈던 불편함을 없애고자 구현.
    
- 코드 커버리지란?
    - 테스트를 논할 때 "얼마나 테스트가 충분한가"를 나타내는 지표중 하나.
    - 코드의 구조를 이루는 것은 Statement, Condition, Decision
        
        ⇒ 이러한 구조를 얼마나 커버했느냐?
        
        - Statement Coverage
            - 실행 코드라인이 한번 이상 실행되면 충족.
        - Condition Coverage
            - 각 내부 조건이 참 혹은 거짓을 가지면 충족.
        - Decision Coverage
            - 각 분기의 내부 조건자체가 아닌 이러한 조건으로 인해 전체 결과가 참 혹은 거짓이면 충족
        - MC / DC Converage 등등...
    - 측정하는 방법은 로그를 찍어가거나 디버거를 이용하여 볼수는 있으나 매우 힘든 과정.
    - 그래서 코드 커버리지 분석 도구를 사용한다.
        
        ⇒ DT10, LDRA, VectorCAST, CodeScroll Controller Tester, QualityScroll Cover 등등...
        

## 첫째, 돌려보자

- 코드 커버리지 분석 도구인 Clover를 이용하여
단위 테스트가 실행하는 코드와 실행하지 않는 코드를 조사.
⇒ 91 / 185 개의 문장만 실행 가능한 것으로 확인.
- 클래스를 철저히 이해하고 리팩터링을 하기 위해 독자적인 단위 테스트 케이스 구현.
- 통과해야할 코드의 배신.
- 경계 조건 오류 수정
    
    ⇒ 이미 한 번 손봤다는 코드이지만 여전히 오류가 존재했었다.
    
- 결코 실행되지 않는 코드(항상 false)도 존재했다.
    
    ⇒ 알고리즘이 틀렸었다.
    
- 오류 문자열을 반환하는 대신 Exception을 던져 테스트를 통과시켰다.

⇒ 위와 같이 변경한 코드는 모든 테스트 케이스를 통과했다. 이제 올바로 고쳐보자.

## 둘째, 고쳐보자

- 변경 이력 부분 제거
- import문 축약
- 다양한 언어를 사용할때도 소스 코드에 보이는 형식이 유지되도록.
- 정확하지 못한 용어("일렬번호")
- 구현을 암시할 필요가 없는 추상 클래스 이름 (SerialDate ⇒ DayDate 변경)
- 직렬화를 제어하는 변수(serialVersionUID)
⇒ 선언하지 않으면 컴파일러가 자동으로 생성. 그게 더 안전하다고 여김
- 불필요한 주석 제거
- 추상 클래스로, 구체적인 구현 정보를 포함할 필요가 없다.

- 일반적으로 부모 클래스는 자식 클래스를 몰라야 바람직하다. (352p)
    
    ⇒ ABSTRACT FACTORY 패턴을 적용하여 DayDateFactory를 만들었다.
    
- 더 서술적인 이름 사용

- 추상 메서드로 위임하는 정적 메서드는 SINGLETOM, DECORATOR, ABSTRACT FACTORY 패던 조합을 사용.
- 변수 위치 이동
    
    ⇒ 사용되는 위치에 가깝게.
    
- 변수 성질 변경
- 불필요한 변수 제거
- 수학적 명칭을 사용한 상수명 변경 (Interval, CLOSED, OPEN ...)

- 설명이 부실한 주석은 코드만 복잡하게 만들 뿐.
- 이중 if → || 사용하여 제거

- 한 군데에서만 호출하는 메서드 융합

- 알고리즘이 다소 복잡하므로 임시 변수 설명(EXPLAINING TEMPORARY VARIABLES)을 사용하여 더 읽기 쉽게 고쳤다.

- 작업 정리
    1. 처음에 나오는 주석은 너무 오래된...
    2. enum을 모두 독자적인 소스 파일로 이동
    3. 정적 변수와 정적 메서드를 새 클래스로 이동
    4. 추상 메서드를 DayDate 클래스로 끌어올림
    5. Month.make ⇒ Month.fromInt로 변경
    6. 중복 제거
    7. 1 제거
    
    ⇒ 코드 커버리지는 84.9% 감소...!
    
    ⇒ 클래스 크기가 사라지는 바람에...